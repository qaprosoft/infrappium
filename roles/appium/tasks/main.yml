---

- name: Install Android SDK
  include: android-sdk.yml

- name: Install "Appium" package.
  command: npm install appium@{{ appium_version }} --prefix {{ appium_install_location }} --unsafe-perm true

# hotfix for screenrecord pidof functionality
- name: override appium-adb/build/lib/tools/adb-commands.js file
  copy: src="roles/appium/templates/adb-commands.js" dest={{ appium_install_location }}/node_modules/appium/node_modules/appium-adb/build/lib/tools/adb-commands.js

# return extra informationin logs about failure
- name: override appium-base-driver/build/lib/protocol/protocol.js file
  copy: src="roles/appium/templates/protocol.js" dest={{ appium_install_location }}/node_modules/appium/node_modules/appium-base-driver/build/lib/protocol/protocol.js

- name: Archive MCloud data
  shell: tar -czvf appium.tar.gz /opt/mcloud

